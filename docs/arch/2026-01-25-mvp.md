# ccx (Claude Code eXecutor) MVP Architecture

## Overview

`maestro` is a CLI tool for managing Claude Code sessions running inside tmux. It allows users to start background Claude sessions, monitor their status, and stop them when complete.

## Purpose

- Run Claude Code prompts in detached tmux sessions
- Track multiple concurrent Claude sessions
- Preview session output without attaching
- Clean up sessions when done

## CLI Commands

### `maestro start "<prompt>"`
Creates a new detached tmux session and runs Claude Code with the given prompt.

```bash
maestro start "explain this codebase"
# Output: Started session: ccx-a1b2c3d4
#         Attach with: tmux attach -t ccx-a1b2c3d4
```

### `maestro list`
Lists all active ccx sessions.

```bash
maestro list
# SESSION              ATTACHED
# -------------------- ----------
# ccx-a1b2c3d4         no
# ccx-e5f6g7h8         yes
```

### `maestro status`
Shows detailed status of all sessions including recent output preview.

```bash
maestro status
# === ccx-a1b2c3d4 ===
#   Attached: no
#   Recent output:
#   | Working on your request...
#   | Analyzing files...
```

### `maestro stop <session>`
Terminates a specific tmux session.

```bash
maestro stop ccx-a1b2c3d4
# Stopped session: ccx-a1b2c3d4
```

## Session Naming Convention

All sessions use the prefix `ccx-` followed by an 8-character hex ID:
- Format: `ccx-<8-hex-chars>`
- Example: `ccx-a1b2c3d4`

This prefix allows the tool to identify its own sessions without interfering with other tmux sessions.

## Tmux Integration

### Session Creation
```bash
tmux new-session -d -s <session-name> 'claude --print "<prompt>"'
```
- `-d`: Detached mode (runs in background)
- `-s`: Sets session name
- Command runs Claude with `--print` flag

### Session Listing
```bash
tmux list-sessions -F "#{session_name}:#{session_created}:#{session_attached}"
```
Output is filtered to only show sessions with `ccx-` prefix.

### Output Capture
```bash
tmux capture-pane -t <session> -p -S -<lines>
```
- `-p`: Print to stdout
- `-S -N`: Start capture N lines back

### Session Termination
```bash
tmux kill-session -t <session-name>
```

## Project Structure

```
ccx/
├── Cargo.toml          # Project manifest
├── src/
│   ├── main.rs         # CLI entry point, clap definitions
│   └── tmux.rs         # Tmux shell command wrappers
└── docs/
    └── arch/
        └── 2026-01-25-mvp.md  # This document
```

## Dependencies

- **clap** (v4, derive feature): Command-line argument parsing
- **anyhow** (v1): Error handling

## Future Considerations

- **Session persistence**: Save session metadata to disk for recovery after tool restart
- **Multiple prompts**: Send follow-up prompts to existing sessions
- **Attach mode**: Built-in attach command with session selection
- **Output logging**: Automatically save session output to files
- **Session groups**: Tag and manage related sessions together
- **Timeout handling**: Auto-cleanup stale or completed sessions
